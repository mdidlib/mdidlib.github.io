<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Integrity & Citations (APA) - Research Toolkit</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #faf9f7; }
        .font-serif { font-family: 'Instrument Serif', Georgia, serif; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
        .animate-slideIn { animation: slideIn 0.3s ease-out; }
        .progress-bar { transition: width 0.5s ease-out; }
        .option-btn { transition: all 0.2s ease; }
        .option-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        // Icons
        const ChevronRight = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>;
        const ChevronLeft = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>;
        const CheckCircle = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
        const XCircle = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeWidth={2} /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 9l-6 6M9 9l6 6" /></svg>;
        const FileText = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>;
        const RefreshCw = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>;
        const Lightbulb = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>;
        const Target = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeWidth={2} /><circle cx="12" cy="12" r="6" strokeWidth={2} /><circle cx="12" cy="12" r="2" strokeWidth={2} /></svg>;
        const AlertTriangle = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>;

        const CitationsAPAModule = () => {
            const [screen, setScreen] = useState('welcome');
            const [currentStep, setCurrentStep] = useState(0);
            const [score, setScore] = useState(0);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showFeedback, setShowFeedback] = useState(false);
            const [isCorrect, setIsCorrect] = useState(false);
            const [attempts, setAttempts] = useState(0);
            const [showHint, setShowHint] = useState(false);
            const [triedAnswers, setTriedAnswers] = useState([]);
            const [completedSteps, setCompletedSteps] = useState([]);

            const totalPoints = 170;

            const steps = [
                // SECTION 1: WHY CITATIONS MATTER
                {
                    id: 'why-1',
                    section: 'Why Citations Matter',
                    type: 'content',
                    title: 'The Purpose of Citations',
                    content: (
                        <div className="space-y-6">
                            <p className="text-lg text-gray-700 leading-relaxed">
                                Citations aren't just a bureaucratic requirement ‚Äî they serve 
                                <span className="font-semibold text-violet-700"> essential purposes</span> in academic work:
                            </p>
                            <div className="grid md:grid-cols-2 gap-4">
                                <div className="bg-white border border-gray-200 rounded-xl p-5 shadow-sm">
                                    <div className="text-2xl mb-2">üéØ</div>
                                    <h4 className="font-semibold text-gray-900 mb-1">Give Credit</h4>
                                    <p className="text-gray-600 text-sm">Acknowledge the scholars whose ideas you're building on. It's intellectual honesty.</p>
                                </div>
                                <div className="bg-white border border-gray-200 rounded-xl p-5 shadow-sm">
                                    <div className="text-2xl mb-2">üîç</div>
                                    <h4 className="font-semibold text-gray-900 mb-1">Enable Verification</h4>
                                    <p className="text-gray-600 text-sm">Readers can check your sources and verify your claims. This builds trust.</p>
                                </div>
                                <div className="bg-white border border-gray-200 rounded-xl p-5 shadow-sm">
                                    <div className="text-2xl mb-2">üó£Ô∏è</div>
                                    <h4 className="font-semibold text-gray-900 mb-1">Join the Conversation</h4>
                                    <p className="text-gray-600 text-sm">Show how your work connects to existing scholarship. You're part of a larger dialogue.</p>
                                </div>
                                <div className="bg-white border border-gray-200 rounded-xl p-5 shadow-sm">
                                    <div className="text-2xl mb-2">üí™</div>
                                    <h4 className="font-semibold text-gray-900 mb-1">Strengthen Your Argument</h4>
                                    <p className="text-gray-600 text-sm">Expert sources add credibility and weight to your claims.</p>
                                </div>
                            </div>
                            <div className="bg-violet-50 border-l-4 border-violet-500 p-5 rounded-r-lg">
                                <p className="text-violet-800">
                                    <strong>Think of it this way:</strong> Citations are how academics show respect for each other's work 
                                    and maintain integrity in the pursuit of knowledge.
                                </p>
                            </div>
                        </div>
                    )
                },
                {
                    id: 'why-2',
                    section: 'Why Citations Matter',
                    type: 'content',
                    title: 'What is Plagiarism?',
                    content: (
                        <div className="space-y-6">
                            <p className="text-lg text-gray-700 leading-relaxed">
                                <span className="font-semibold text-red-700">Plagiarism</span> is presenting someone else's words, ideas, 
                                or work as your own ‚Äî whether intentionally or accidentally.
                            </p>
                            <div className="bg-red-50 border border-red-200 rounded-xl p-6">
                                <p className="font-semibold text-red-800 mb-4 flex items-center gap-2">
                                    <AlertTriangle className="w-5 h-5" />
                                    Forms of Plagiarism
                                </p>
                                <div className="space-y-3">
                                    <div className="flex items-start gap-3">
                                        <XCircle className="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5" />
                                        <div>
                                            <p className="font-medium text-red-800">Direct copying</p>
                                            <p className="text-red-700 text-sm">Using exact words without quotation marks and citation</p>
                                        </div>
                                    </div>
                                    <div className="flex items-start gap-3">
                                        <XCircle className="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5" />
                                        <div>
                                            <p className="font-medium text-red-800">Paraphrasing without citation</p>
                                            <p className="text-red-700 text-sm">Rewording ideas but not crediting the original source</p>
                                        </div>
                                    </div>
                                    <div className="flex items-start gap-3">
                                        <XCircle className="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5" />
                                        <div>
                                            <p className="font-medium text-red-800">Mosaic plagiarism</p>
                                            <p className="text-red-700 text-sm">Mixing copied phrases with your own words without proper attribution</p>
                                        </div>
                                    </div>
                                    <div className="flex items-start gap-3">
                                        <XCircle className="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5" />
                                        <div>
                                            <p className="font-medium text-red-800">Self-plagiarism</p>
                                            <p className="text-red-700 text-sm">Reusing your own previous work without acknowledgment</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-amber-50 border border-amber-200 rounded-xl p-5">
                                <p className="text-amber-800">
                                    <strong>üí° Important:</strong> Plagiarism can be accidental! Taking good notes and citing as you 
                                    research (not just at the end) helps prevent unintentional plagiarism.
                                </p>
                            </div>
                        </div>
                    )
                },
                {
                    id: 'quiz-1',
                    section: 'Why Citations Matter',
                    type: 'quiz',
                    title: 'Identify Plagiarism',
                    question: 'A student reads an article, puts it aside, then writes a paragraph using the same ideas in their own words WITHOUT citing the source. This is:',
                    options: [
                        { id: 'a', text: 'Fine ‚Äî they used their own words' },
                        { id: 'b', text: 'Plagiarism ‚Äî ideas must be cited even when paraphrased' },
                        { id: 'c', text: 'Only a problem if the teacher notices' },
                        { id: 'd', text: 'Acceptable as long as they cite other sources in the paper' }
                    ],
                    correct: 'b',
                    explanation: 'Even when you paraphrase (put ideas in your own words), you must cite the source of those ideas. Using your own words doesn\'t make the ideas yours. This is one of the most common forms of unintentional plagiarism.',
                    wrongFeedback: 'Consider what belongs to the original author. When someone develops an idea or makes an argument, ownership extends beyond just the exact words ‚Äî it includes the ideas themselves. Rephrasing doesn\'t transfer ownership.',
                    hint: 'Think about what belongs to the original author ‚Äî just the words, or also the ideas?',
                    points: 15
                },
                // SECTION 2: QUOTING VS PARAPHRASING
                {
                    id: 'quote-1',
                    section: 'Quoting & Paraphrasing',
                    type: 'content',
                    title: 'When to Quote vs. Paraphrase',
                    content: (
                        <div className="space-y-6">
                            <p className="text-lg text-gray-700 leading-relaxed">
                                Both quoting and paraphrasing require citations, but they serve different purposes:
                            </p>
                            <div className="grid md:grid-cols-2 gap-6">
                                <div className="bg-blue-50 border border-blue-200 rounded-xl p-5">
                                    <p className="font-semibold text-blue-800 mb-3 text-lg">"Direct Quotes"</p>
                                    <p className="text-blue-700 mb-3">Use the author's exact words in quotation marks.</p>
                                    <p className="font-medium text-blue-800 mb-2">Use when:</p>
                                    <ul className="space-y-1 text-blue-700 text-sm">
                                        <li>‚Ä¢ The exact wording is important</li>
                                        <li>‚Ä¢ The author said it perfectly</li>
                                        <li>‚Ä¢ You're analyzing the language itself</li>
                                        <li>‚Ä¢ It's a key definition or famous phrase</li>
                                    </ul>
                                </div>
                                <div className="bg-emerald-50 border border-emerald-200 rounded-xl p-5">
                                    <p className="font-semibold text-emerald-800 mb-3 text-lg">Paraphrasing</p>
                                    <p className="text-emerald-700 mb-3">Restate the idea completely in your own words.</p>
                                    <p className="font-medium text-emerald-800 mb-2">Use when:</p>
                                    <ul className="space-y-1 text-emerald-700 text-sm">
                                        <li>‚Ä¢ The idea matters more than the wording</li>
                                        <li>‚Ä¢ You can say it more clearly</li>
                                        <li>‚Ä¢ You're summarizing a longer passage</li>
                                        <li>‚Ä¢ You want smoother flow in your writing</li>
                                    </ul>
                                </div>
                            </div>
                            <div className="bg-amber-50 border border-amber-200 rounded-xl p-5">
                                <p className="text-amber-800">
                                    <strong>‚ö†Ô∏è Balance matters:</strong> Too many quotes can make your paper feel like a patchwork 
                                    of other people's words. Aim to paraphrase most of the time, quoting only when the exact 
                                    words truly matter.
                                </p>
                            </div>
                        </div>
                    )
                },
                {
                    id: 'quote-2',
                    section: 'Quoting & Paraphrasing',
                    type: 'content',
                    title: 'How to Paraphrase Properly',
                    content: (
                        <div className="space-y-6">
                            <p className="text-lg text-gray-700 leading-relaxed">
                                Good paraphrasing is more than just swapping out a few words. Follow this process:
                            </p>
                            <div className="space-y-4">
                                {[
                                    { num: '1', title: 'Read and understand', desc: 'Read the passage several times until you fully understand the meaning.', color: 'violet' },
                                    { num: '2', title: 'Set it aside', desc: 'Put the source away. Don\'t look at it while you write.', color: 'blue' },
                                    { num: '3', title: 'Write in your own words', desc: 'Explain the idea as if telling a friend. Use your own sentence structure.', color: 'emerald' },
                                    { num: '4', title: 'Compare and check', desc: 'Compare your version to the original. Is it different enough? Did you capture the meaning?', color: 'amber' },
                                    { num: '5', title: 'Add your citation', desc: 'Even though it\'s in your words, the idea came from somewhere ‚Äî cite it!', color: 'rose' }
                                ].map((step) => (
                                    <div key={step.num} className="flex items-start gap-4">
                                        <div className={`w-10 h-10 bg-${step.color}-500 rounded-full flex items-center justify-center flex-shrink-0 text-white font-bold`}>
                                            {step.num}
                                        </div>
                                        <div className="pt-1">
                                            <p className="font-semibold text-gray-900">{step.title}</p>
                                            <p className="text-gray-600 text-sm">{step.desc}</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <div className="bg-red-50 border border-red-200 rounded-xl p-5">
                                <p className="text-red-800">
                                    <strong>‚ùå Not paraphrasing:</strong> Copying the sentence and just replacing some words with 
                                    synonyms. This is "patchwriting" and is still considered plagiarism.
                                </p>
                            </div>
                        </div>
                    )
                },
                {
                    id: 'quiz-2',
                    section: 'Quoting & Paraphrasing',
                    type: 'quiz',
                    title: 'Good Paraphrase?',
                    question: 'Original: "Social media has fundamentally transformed how teenagers communicate with peers." \n\nWhich is a PROPER paraphrase?',
                    options: [
                        { id: 'a', text: 'Social media has basically changed how teens talk with friends.' },
                        { id: 'b', text: 'The way young people interact with each other has been dramatically reshaped by platforms like Instagram and TikTok.' },
                        { id: 'c', text: 'Social media has fundamentally transformed teen communication.' },
                        { id: 'd', text: '"Social media has fundamentally transformed how teenagers communicate with peers."' }
                    ],
                    correct: 'b',
                    explanation: 'Option B completely restructures the sentence and uses different vocabulary while preserving the meaning. Option A just swaps a few words (synonyms). Option C is too close to the original. Option D is a quote, not a paraphrase. All would still need citations!',
                    wrongFeedback: 'A proper paraphrase requires completely restructuring the sentence, not just replacing individual words with synonyms. Compare each option\'s sentence structure to the original ‚Äî true paraphrasing changes HOW the idea is expressed, not just which specific words are used.',
                    hint: 'A good paraphrase uses completely different sentence structure, not just synonym swaps.',
                    points: 15
                },
                // SECTION 3: APA BASICS
                {
                    id: 'apa-1',
                    section: 'APA Format Basics',
                    type: 'content',
                    title: 'APA: The Core Principle',
                    content: (
                        <div className="space-y-6">
                            <p className="text-lg text-gray-700 leading-relaxed">
                                APA (American Psychological Association) style is used primarily in 
                                <span className="font-semibold text-blue-700"> sciences and social sciences</span> ‚Äî psychology, biology, economics, nursing, and related fields.
                            </p>
                            <div className="bg-blue-50 border-l-4 border-blue-500 p-5 rounded-r-lg">
                                <p className="font-semibold text-blue-800 mb-2">üî¨ APA's Focus: Author-Date</p>
                                <p className="text-blue-700">
                                    APA emphasizes <strong>when</strong> research was published because in sciences, 
                                    currency matters. The author-date system puts the publication year front and center.
                                </p>
                            </div>
                            <div className="bg-white border border-gray-200 rounded-xl p-6">
                                <p className="font-semibold text-gray-800 mb-4">The APA Reference Elements (in order):</p>
                                <div className="space-y-2 text-sm">
                                    <p><span className="font-mono bg-gray-100 px-2 py-1 rounded">1.</span> <strong>Author.</strong> (Last name, Initials.)</p>
                                    <p><span className="font-mono bg-gray-100 px-2 py-1 rounded">2.</span> <strong>(Year).</strong> Publication date in parentheses</p>
                                    <p><span className="font-mono bg-gray-100 px-2 py-1 rounded">3.</span> <strong>Title of work.</strong> Sentence case, italicized for books/journals</p>
                                    <p><span className="font-mono bg-gray-100 px-2 py-1 rounded">4.</span> <strong>Source information.</strong> Publisher, journal name, URL, DOI</p>
                                </div>
                            </div>
                            <div className="bg-amber-50 border border-amber-200 rounded-xl p-5">
                                <p className="text-amber-800">
                                    <strong>üí° Key difference from MLA:</strong> APA uses sentence case for titles (only capitalize 
                                    the first word and proper nouns), while MLA uses title case.
                                </p>
                            </div>
                        </div>
                    )
                },
                {
                    id: 'apa-2',
                    section: 'APA Format Basics',
                    type: 'content',
                    title: 'APA In-Text Citations',
                    content: (
                        <div className="space-y-6">
                            <p className="text-lg text-gray-700 leading-relaxed">
                                In-text citations point readers to your References page. APA uses 
                                <span className="font-semibold text-blue-700"> author-date</span> format:
                            </p>
                            <div className="space-y-4">
                                <div className="bg-white border border-gray-200 rounded-xl p-5">
                                    <p className="font-semibold text-gray-800 mb-3">Basic format (parenthetical):</p>
                                    <div className="bg-gray-50 rounded-lg p-4">
                                        <p className="text-gray-700">
                                            Social media affects teen mental health 
                                            <span className="bg-blue-100 px-1 rounded">(Smith, 2024)</span>.
                                        </p>
                                    </div>
                                    <p className="text-gray-500 text-sm mt-2">‚Üí Author's last name, comma, year</p>
                                </div>
                                <div className="bg-white border border-gray-200 rounded-xl p-5">
                                    <p className="font-semibold text-gray-800 mb-3">Author named in sentence (narrative):</p>
                                    <div className="bg-gray-50 rounded-lg p-4">
                                        <p className="text-gray-700">
                                            <span className="bg-blue-100 px-1 rounded">Smith (2024)</span> argued that social media affects teen mental health.
                                        </p>
                                    </div>
                                    <p className="text-gray-500 text-sm mt-2">‚Üí Author name with year in parentheses right after</p>
                                </div>
                                <div className="bg-white border border-gray-200 rounded-xl p-5">
                                    <p className="font-semibold text-gray-800 mb-3">With page number (for direct quotes):</p>
                                    <div className="bg-gray-50 rounded-lg p-4">
                                        <p className="text-gray-700">
                                            The study found "significant effects" 
                                            <span className="bg-blue-100 px-1 rounded">(Smith, 2024, p. 45)</span>.
                                        </p>
                                    </div>
                                    <p className="text-gray-500 text-sm mt-2">‚Üí Add "p." and page number for direct quotes</p>
                                </div>
                            </div>
                            <div className="bg-blue-50 border border-blue-200 rounded-xl p-5">
                                <p className="text-blue-800">
                                    <strong>üí° Note:</strong> Unlike MLA, APA uses a comma between author and year, 
                                    and includes "p." before page numbers.
                                </p>
                            </div>
                        </div>
                    )
                },
                {
                    id: 'quiz-3',
                    section: 'APA Format Basics',
                    type: 'quiz',
                    title: 'APA In-Text Practice',
                    question: 'You want to cite a 2023 book by Maria Garcia. Which is the correct APA in-text citation?',
                    options: [
                        { id: 'a', text: '(Garcia 2023)' },
                        { id: 'b', text: '(Garcia, 2023)' },
                        { id: 'c', text: '(Maria Garcia, 2023)' },
                        { id: 'd', text: '(Garcia, p. 2023)' }
                    ],
                    correct: 'b',
                    explanation: 'APA in-text citations use the author\'s last name, a comma, and the year: (LastName, Year). First names are not used. The "p." is only added when citing a specific page for a direct quote.',
                    wrongFeedback: 'APA format has specific punctuation rules. The author-date format requires a comma between the last name and year. First names are never included in in-text citations, and "p." is only used when citing a specific page number for a direct quote.',
                    hint: 'APA uses author-date with a comma between them.',
                    points: 15
                },
                {
                    id: 'apa-3',
                    section: 'APA Format Basics',
                    type: 'content',
                    title: 'APA References Examples',
                    content: (
                        <div className="space-y-6">
                            <p className="text-lg text-gray-700 leading-relaxed">
                                Your References page lists all sources alphabetically by author's last name. Here are common formats:
                            </p>
                            <div className="space-y-4">
                                <div className="bg-white border border-gray-200 rounded-xl p-5">
                                    <p className="font-semibold text-blue-700 mb-2">üìñ Book</p>
                                    <div className="bg-gray-50 rounded-lg p-4 font-mono text-sm">
                                        <p>Smith, J. (2024). <em>Title of the book: Subtitle</em>. Publisher Name.</p>
                                    </div>
                                </div>
                                <div className="bg-white border border-gray-200 rounded-xl p-5">
                                    <p className="font-semibold text-blue-700 mb-2">üì∞ Journal Article (with DOI)</p>
                                    <div className="bg-gray-50 rounded-lg p-4 font-mono text-sm">
                                        <p>Smith, J., & Chen, L. (2024). Title of article. <em>Journal Name, 12</em>(3), 45-67. https://doi.org/xxxxx</p>
                                    </div>
                                </div>
                                <div className="bg-white border border-gray-200 rounded-xl p-5">
                                    <p className="font-semibold text-blue-700 mb-2">üåê Website</p>
                                    <div className="bg-gray-50 rounded-lg p-4 font-mono text-sm">
                                        <p>Smith, J. (2024, March 15). <em>Title of page</em>. Website Name. https://www.example.com/page</p>
                                    </div>
                                </div>
                                <div className="bg-white border border-gray-200 rounded-xl p-5">
                                    <p className="font-semibold text-blue-700 mb-2">üè¢ Organization as Author</p>
                                    <div className="bg-gray-50 rounded-lg p-4 font-mono text-sm">
                                        <p>World Health Organization. (2024). <em>Report title</em>. https://www.who.int/report</p>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-blue-50 border border-blue-200 rounded-xl p-5">
                                <p className="text-blue-800">
                                    <strong>üí° Pro tip:</strong> Always include DOIs when available ‚Äî they're permanent links that 
                                    won't break. Databases like JSTOR and ProQuest can generate APA citations for you.
                                </p>
                            </div>
                        </div>
                    )
                },
                {
                    id: 'quiz-4',
                    section: 'APA Format Basics',
                    type: 'quiz',
                    title: 'APA References',
                    question: 'In APA style, how should article titles be formatted in the References list?',
                    options: [
                        { id: 'a', text: 'In "quotation marks" with Title Case' },
                        { id: 'b', text: 'In italics with Title Case' },
                        { id: 'c', text: 'In plain text with sentence case (only first word capitalized)' },
                        { id: 'd', text: 'In bold with all caps' }
                    ],
                    correct: 'c',
                    explanation: 'In APA, article/chapter titles use sentence case (only capitalize the first word, first word after a colon, and proper nouns) and are NOT italicized. Journal names and book titles ARE italicized. This is different from MLA!',
                    wrongFeedback: 'APA has specific rules about title formatting. Article titles are treated differently from journal/book titles. Think about what "sentence case" means for capitalization, and remember that APA reserves italics for larger works like journals and books, not individual articles.',
                    hint: 'APA uses sentence case for most titles. What does that mean for capitalization?',
                    points: 15
                },
                // SECTION 4: CITING AI
                {
                    id: 'ai-1',
                    section: 'Citing AI Tools',
                    type: 'content',
                    title: 'When and How to Cite AI',
                    content: (
                        <div className="space-y-6">
                            <p className="text-lg text-gray-700 leading-relaxed">
                                If you use AI tools like ChatGPT or Claude in your research, you 
                                <span className="font-semibold text-violet-700"> must acknowledge this</span>. The IB requires transparency about AI use.
                            </p>
                            <div className="bg-violet-50 border-l-4 border-violet-500 p-5 rounded-r-lg">
                                <p className="font-semibold text-violet-800 mb-2">ü§ñ APA Format for AI Tools</p>
                                <div className="bg-white rounded-lg p-4 mt-3 font-mono text-sm">
                                    <p>Author. (Year). <em>Name of AI tool</em> (Version) [Type of AI]. Publisher. URL</p>
                                </div>
                            </div>
                            <div className="bg-white border border-gray-200 rounded-xl p-5">
                                <p className="font-semibold text-gray-800 mb-3">Example Reference:</p>
                                <div className="bg-gray-50 rounded-lg p-4 font-mono text-sm">
                                    <p>OpenAI. (2024). <em>ChatGPT</em> (GPT-4) [Large language model]. https://chat.openai.com</p>
                                </div>
                            </div>
                            <div className="bg-white border border-gray-200 rounded-xl p-5">
                                <p className="font-semibold text-gray-800 mb-3">In-text citation:</p>
                                <div className="bg-gray-50 rounded-lg p-4">
                                    <p className="text-gray-700">
                                        The AI explained that multiple factors contributed to the revolution 
                                        <span className="bg-violet-100 px-1 rounded">(OpenAI, 2024)</span>.
                                    </p>
                                </div>
                                <p className="text-gray-500 text-sm mt-2">‚Üí Cite the company as author</p>
                            </div>
                            <div className="bg-amber-50 border border-amber-200 rounded-xl p-5">
                                <p className="text-amber-800">
                                    <strong>üí° APA recommends:</strong> Include your prompt in the text or describe it when relevant 
                                    to your discussion. For example: "When prompted to explain the causes of..."
                                </p>
                            </div>
                        </div>
                    )
                },
                {
                    id: 'ai-2',
                    section: 'Citing AI Tools',
                    type: 'content',
                    title: 'Documenting AI Use for IB',
                    content: (
                        <div className="space-y-6">
                            <p className="text-lg text-gray-700 leading-relaxed">
                                Beyond citations, the IB expects you to be 
                                <span className="font-semibold text-violet-700"> transparent about HOW you used AI</span>. Many teachers require an AI use statement.
                            </p>
                            <div className="bg-emerald-50 border border-emerald-200 rounded-xl p-6">
                                <p className="font-semibold text-emerald-800 mb-3">‚úì Good AI documentation includes:</p>
                                <ul className="space-y-2 text-emerald-700">
                                    <li className="flex items-start gap-2">
                                        <CheckCircle className="w-5 h-5 flex-shrink-0 mt-0.5 text-emerald-500" />
                                        <span><strong>What tool</strong> you used (ChatGPT, Claude, Perplexity, etc.)</span>
                                    </li>
                                    <li className="flex items-start gap-2">
                                        <CheckCircle className="w-5 h-5 flex-shrink-0 mt-0.5 text-emerald-500" />
                                        <span><strong>How</strong> you used it (brainstorming, explaining concepts, proofreading)</span>
                                    </li>
                                    <li className="flex items-start gap-2">
                                        <CheckCircle className="w-5 h-5 flex-shrink-0 mt-0.5 text-emerald-500" />
                                        <span><strong>What</strong> you did with the output (verified, modified, used as starting point)</span>
                                    </li>
                                </ul>
                            </div>
                            <div className="bg-white border border-gray-200 rounded-xl p-5">
                                <p className="font-semibold text-gray-800 mb-3">Example AI acknowledgment:</p>
                                <div className="bg-gray-50 rounded-lg p-4 text-sm text-gray-700 italic">
                                    "I used ChatGPT (OpenAI, 2024) to help brainstorm initial research questions and to explain the concept of 
                                    economic elasticity. All AI-generated explanations were verified against textbook sources, 
                                    and the final analysis and arguments are my own work."
                                </div>
                            </div>
                            <div className="bg-amber-50 border border-amber-200 rounded-xl p-5">
                                <p className="text-amber-800">
                                    <strong>‚ö†Ô∏è Remember:</strong> Cite AI in your References AND explain your use. 
                                    Being transparent protects you and demonstrates academic integrity.
                                </p>
                            </div>
                        </div>
                    )
                },
                {
                    id: 'quiz-5',
                    section: 'Citing AI Tools',
                    type: 'quiz',
                    title: 'AI Citation Practice',
                    question: 'You used Claude to help understand a difficult concept, then wrote about it in your own words. What should you do?',
                    options: [
                        { id: 'a', text: 'No citation needed ‚Äî you wrote it in your own words' },
                        { id: 'b', text: 'Cite Claude in your References and acknowledge AI use in your paper' },
                        { id: 'c', text: 'Just mention "AI" somewhere in your paper' },
                        { id: 'd', text: 'Only cite if your teacher specifically asks' }
                    ],
                    correct: 'b',
                    explanation: 'Even when you rephrase AI output in your own words, you used it as a source for understanding. Cite it properly in your References AND be transparent about how you used it. This is what academic integrity looks like in the AI age.',
                    wrongFeedback: 'The IB requires transparency about AI use. When AI helps you understand something that then appears in your work, you need to acknowledge that assistance ‚Äî both through proper citation and by explaining how you used the tool. Vague mentions or waiting to be asked aren\'t sufficient.',
                    hint: 'Think about the principles from Module 2: what does the IB expect regarding AI transparency?',
                    points: 20
                },
                // SECTION 5: PRACTICAL APPLICATION
                {
                    id: 'practice-1',
                    section: 'Putting It Together',
                    type: 'content',
                    title: 'Citation Workflow',
                    content: (
                        <div className="space-y-6">
                            <p className="text-lg text-gray-700 leading-relaxed">
                                Good citation habits start <span className="font-semibold text-violet-700">during</span> research, not after. Here's an effective workflow:
                            </p>
                            <div className="relative">
                                <div className="absolute left-5 top-0 bottom-0 w-0.5 bg-blue-200"></div>
                                <div className="space-y-6">
                                    {[
                                        { num: '1', title: 'Collect as you go', desc: 'Every time you find a useful source, immediately record all citation information. Use a citation manager or simple document.', color: 'blue' },
                                        { num: '2', title: 'Note page numbers', desc: 'When you take notes from a source, always write down the page number. You\'ll need it for direct quotes.', color: 'violet' },
                                        { num: '3', title: 'Mark direct quotes clearly', desc: 'In your notes, use quotation marks and highlight anything that\'s a direct quote. This prevents accidental plagiarism.', color: 'emerald' },
                                        { num: '4', title: 'Track AI interactions', desc: 'Keep a log of your AI prompts and how you used the responses. Screenshot or save chat logs.', color: 'purple' },
                                        { num: '5', title: 'Build References incrementally', desc: 'Add to your References as you write, not at the end. This ensures nothing is forgotten.', color: 'amber' }
                                    ].map((step, i) => (
                                        <div key={step.num} className="flex items-start gap-4 pl-2">
                                            <div className={`w-10 h-10 bg-${step.color}-500 rounded-full flex items-center justify-center flex-shrink-0 text-white font-bold relative z-10`}>
                                                {step.num}
                                            </div>
                                            <div className="bg-white border border-gray-200 rounded-xl p-4 flex-1 shadow-sm">
                                                <p className="font-semibold text-gray-900">{step.title}</p>
                                                <p className="text-gray-600 text-sm mt-1">{step.desc}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )
                },
                {
                    id: 'practice-2',
                    section: 'Putting It Together',
                    type: 'content',
                    title: 'Helpful Tools',
                    content: (
                        <div className="space-y-6">
                            <p className="text-lg text-gray-700 leading-relaxed">
                                These tools can help manage your citations (but always double-check their output!):
                            </p>
                            <div className="grid gap-4">
                                <div className="bg-white border border-gray-200 rounded-xl p-5 shadow-sm">
                                    <div className="flex items-start gap-4">
                                        <div className="text-2xl">üìö</div>
                                        <div>
                                            <h4 className="font-semibold text-gray-900">NoodleTools</h4>
                                            <p className="text-gray-600 text-sm mt-1">Your school may have access. Creates properly formatted citations and helps organize research.</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-white border border-gray-200 rounded-xl p-5 shadow-sm">
                                    <div className="flex items-start gap-4">
                                        <div className="text-2xl">üîß</div>
                                        <div>
                                            <h4 className="font-semibold text-gray-900">ZoteroBib / MyBib</h4>
                                            <p className="text-gray-600 text-sm mt-1">Free online tools. Paste in a URL, DOI, or ISBN and get a formatted citation. Quick and easy.</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-white border border-gray-200 rounded-xl p-5 shadow-sm">
                                    <div className="flex items-start gap-4">
                                        <div className="text-2xl">üóÑÔ∏è</div>
                                        <div>
                                            <h4 className="font-semibold text-gray-900">Database Export</h4>
                                            <p className="text-gray-600 text-sm mt-1">JSTOR, ProQuest, and PubMed have "Cite" buttons. Export citations directly in APA format.</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-white border border-gray-200 rounded-xl p-5 shadow-sm">
                                    <div className="flex items-start gap-4">
                                        <div className="text-2xl">üìñ</div>
                                        <div>
                                            <h4 className="font-semibold text-gray-900">Purdue OWL</h4>
                                            <p className="text-gray-600 text-sm mt-1">The definitive free APA guide online. When in doubt, check owl.purdue.edu for examples.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-amber-50 border border-amber-200 rounded-xl p-5">
                                <p className="text-amber-800">
                                    <strong>‚ö†Ô∏è Always verify:</strong> Auto-generated citations often have errors ‚Äî wrong capitalization, 
                                    missing information, incorrect formatting. Use tools as a starting point, then check carefully.
                                </p>
                            </div>
                        </div>
                    )
                },
                {
                    id: 'quiz-6',
                    section: 'Putting It Together',
                    type: 'quiz',
                    title: 'Best Practices',
                    question: 'When is the BEST time to record citation information for a source?',
                    options: [
                        { id: 'a', text: 'After you finish writing your paper' },
                        { id: 'b', text: 'The night before the deadline' },
                        { id: 'c', text: 'As soon as you find and decide to use the source' },
                        { id: 'd', text: 'Only for sources you directly quote' }
                    ],
                    correct: 'c',
                    explanation: 'Record citation information immediately when you find a useful source! Waiting until later means you might forget sources, lose track of page numbers, or scramble to relocate information. Cite as you go, not as an afterthought.',
                    wrongFeedback: 'Consider when problems with citations typically arise. If you wait until later, you might forget which sources you used, lose track of page numbers, or struggle to relocate the information. The best approach prevents these problems before they happen.',
                    hint: 'Think about preventing problems rather than fixing them later.',
                    points: 15
                },
                {
                    id: 'quiz-7',
                    section: 'Putting It Together',
                    type: 'quiz',
                    title: 'Final Check',
                    question: 'What\'s the relationship between in-text citations and the References page?',
                    options: [
                        { id: 'a', text: 'They\'re separate ‚Äî you only need one or the other' },
                        { id: 'b', text: 'Every in-text citation must have a matching entry in References, and vice versa' },
                        { id: 'c', text: 'References is optional if you have in-text citations' },
                        { id: 'd', text: 'In-text citations are only needed for direct quotes' }
                    ],
                    correct: 'b',
                    explanation: 'In-text citations and References work together as a system. Every (Author, Year) in your text points to a full entry in References, and every References entry should be cited somewhere in your paper. They must match perfectly.',
                    wrongFeedback: 'In-text citations and the References page are designed to work together as an integrated system. Consider what a reader needs: the in-text citation tells them who said something, and the References page tells them where to find it. Both elements are essential for every source you use.',
                    hint: 'Think of them as partners ‚Äî one doesn\'t work without the other.',
                    points: 20
                },
                {
                    id: 'final',
                    section: 'Putting It Together',
                    type: 'content',
                    title: 'APA Quick Reference',
                    content: (
                        <div className="space-y-6">
                            <p className="text-lg text-gray-700 leading-relaxed">
                                Keep this reference handy as you work on your research project:
                            </p>
                            <div className="bg-blue-50 border border-blue-200 rounded-xl p-6">
                                <h4 className="font-semibold text-blue-800 mb-4">üìã APA Checklist</h4>
                                <div className="space-y-2">
                                    <label className="flex items-start gap-3 text-blue-700">
                                        <span className="w-5 h-5 border-2 border-blue-300 rounded mt-0.5 flex-shrink-0"></span>
                                        <span>In-text citations: (Author, Year) ‚Äî with comma</span>
                                    </label>
                                    <label className="flex items-start gap-3 text-blue-700">
                                        <span className="w-5 h-5 border-2 border-blue-300 rounded mt-0.5 flex-shrink-0"></span>
                                        <span>Direct quotes add page: (Author, Year, p. #)</span>
                                    </label>
                                    <label className="flex items-start gap-3 text-blue-700">
                                        <span className="w-5 h-5 border-2 border-blue-300 rounded mt-0.5 flex-shrink-0"></span>
                                        <span>Journal/book titles in <em>italics</em></span>
                                    </label>
                                    <label className="flex items-start gap-3 text-blue-700">
                                        <span className="w-5 h-5 border-2 border-blue-300 rounded mt-0.5 flex-shrink-0"></span>
                                        <span>Article titles in sentence case (not italicized)</span>
                                    </label>
                                    <label className="flex items-start gap-3 text-blue-700">
                                        <span className="w-5 h-5 border-2 border-blue-300 rounded mt-0.5 flex-shrink-0"></span>
                                        <span>References alphabetized by author's last name</span>
                                    </label>
                                    <label className="flex items-start gap-3 text-blue-700">
                                        <span className="w-5 h-5 border-2 border-blue-300 rounded mt-0.5 flex-shrink-0"></span>
                                        <span>Hanging indent for References entries</span>
                                    </label>
                                    <label className="flex items-start gap-3 text-blue-700">
                                        <span className="w-5 h-5 border-2 border-blue-300 rounded mt-0.5 flex-shrink-0"></span>
                                        <span>Include DOIs when available</span>
                                    </label>
                                    <label className="flex items-start gap-3 text-blue-700">
                                        <span className="w-5 h-5 border-2 border-blue-300 rounded mt-0.5 flex-shrink-0"></span>
                                        <span>AI tools cited with company, year, tool name, version</span>
                                    </label>
                                </div>
                            </div>
                            <div className="bg-violet-50 border border-violet-200 rounded-xl p-5">
                                <p className="text-violet-800">
                                    <strong>üéâ You've completed the APA track!</strong> Remember: when in doubt, check Purdue OWL 
                                    or ask your librarian. Good citation habits take practice, but they're essential for academic success.
                                </p>
                            </div>
                        </div>
                    )
                }
            ];

            const currentStepData = steps[currentStep];
            const totalSteps = steps.length;
            const progressPercent = ((currentStep + 1) / totalSteps) * 100;

            const getSectionColor = () => {
                if (!currentStepData) return 'blue';
                const section = currentStepData.section;
                if (section === 'Why Citations Matter') return 'violet';
                if (section === 'Quoting & Paraphrasing') return 'emerald';
                if (section === 'APA Format Basics') return 'blue';
                if (section === 'Citing AI Tools') return 'purple';
                if (section === 'Putting It Together') return 'amber';
                return 'blue';
            };

            const sectionColor = getSectionColor();

            const resetQuiz = () => {
                setSelectedAnswer(null);
                setShowFeedback(false);
                setIsCorrect(false);
                setAttempts(0);
                setShowHint(false);
                setTriedAnswers([]);
            };

            const handleNext = () => {
                if (currentStep < totalSteps - 1) {
                    setCurrentStep(currentStep + 1);
                    resetQuiz();
                } else {
                    setScreen('complete');
                }
            };

            const handlePrev = () => {
                if (currentStep > 0) {
                    setCurrentStep(currentStep - 1);
                    resetQuiz();
                }
            };

            const handleAnswerSelect = (id) => {
                if (showFeedback) return;
                if (triedAnswers.includes(id)) return;
                setSelectedAnswer(id);
            };

            const checkAnswer = () => {
                if (!selectedAnswer) return;
                const correct = selectedAnswer === currentStepData.correct;
                setIsCorrect(correct);
                setShowFeedback(true);
                
                if (correct) {
                    // Graduated scoring based on attempts
                    let earnedPoints;
                    if (attempts === 0) {
                        earnedPoints = currentStepData.points; // Full points
                    } else if (attempts === 1) {
                        earnedPoints = Math.floor(currentStepData.points * 0.75); // 75%
                    } else if (attempts === 2) {
                        earnedPoints = Math.floor(currentStepData.points * 0.5); // 50%
                    } else {
                        earnedPoints = Math.floor(currentStepData.points * 0.25); // 25%
                    }
                    setScore(score + earnedPoints);
                    setCompletedSteps([...completedSteps, currentStepData.id]);
                } else {
                    // Track this wrong answer
                    setTriedAnswers([...triedAnswers, selectedAnswer]);
                    setAttempts(attempts + 1);
                }
            };

            const handleTryAgain = () => {
                setShowFeedback(false);
                setSelectedAnswer(null);
                setShowHint(true);
            };

            const restart = () => {
                setScreen('welcome');
                setCurrentStep(0);
                setScore(0);
                setSelectedAnswer(null);
                setShowFeedback(false);
                setIsCorrect(false);
                setAttempts(0);
                setShowHint(false);
                setTriedAnswers([]);
                setCompletedSteps([]);
            };

            // WELCOME SCREEN
            if (screen === 'welcome') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-500 via-indigo-600 to-violet-700 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 lg:p-12 max-w-3xl w-full animate-fadeIn">
                            <div className="text-center">
                                <div className="w-20 h-20 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-6">
                                    <FileText className="w-10 h-10 text-blue-600" />
                                </div>
                                <div className="inline-block bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-semibold mb-4">
                                    APA FORMAT
                                </div>
                                <p className="text-sm font-semibold text-violet-600 uppercase tracking-wider mb-2">Module 03</p>
                                <h1 className="text-4xl lg:text-5xl font-serif text-gray-900 mb-4">Academic Integrity & Citations</h1>
                                <p className="text-xl text-gray-600 mb-8 leading-relaxed">
                                    Learn why citations matter, how to quote and paraphrase properly, 
                                    and master APA format ‚Äî including how to cite AI tools.
                                </p>
                                
                                <div className="bg-gray-50 rounded-xl p-6 mb-8 text-left">
                                    <h3 className="font-semibold text-gray-900 mb-4 flex items-center gap-2">
                                        <Target className="w-5 h-5 text-blue-600" />
                                        What you'll learn:
                                    </h3>
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className="flex items-start gap-3">
                                            <div className="w-8 h-8 bg-violet-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                                <span className="text-violet-700 font-bold text-sm">1</span>
                                            </div>
                                            <div>
                                                <p className="font-medium text-gray-900 text-sm">Why Citations Matter</p>
                                                <p className="text-gray-500 text-xs">Purpose & plagiarism prevention</p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                                <span className="text-emerald-700 font-bold text-sm">2</span>
                                            </div>
                                            <div>
                                                <p className="font-medium text-gray-900 text-sm">Quoting & Paraphrasing</p>
                                                <p className="text-gray-500 text-xs">When and how to use each</p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                                <span className="text-blue-700 font-bold text-sm">3</span>
                                            </div>
                                            <div>
                                                <p className="font-medium text-gray-900 text-sm">APA Format</p>
                                                <p className="text-gray-500 text-xs">In-text citations & References</p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                                <span className="text-purple-700 font-bold text-sm">4</span>
                                            </div>
                                            <div>
                                                <p className="font-medium text-gray-900 text-sm">Citing AI Tools</p>
                                                <p className="text-gray-500 text-xs">APA format for ChatGPT, Claude, etc.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="flex items-center justify-center gap-6 text-sm text-gray-500 mb-8">
                                    <span className="flex items-center gap-2">
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        ~50 minutes
                                    </span>
                                    <span className="flex items-center gap-2">
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        7 interactive quizzes
                                    </span>
                                    <span className="flex items-center gap-2">
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                                        </svg>
                                        {totalPoints} points possible
                                    </span>
                                </div>
                                
                                <button
                                    onClick={() => setScreen('learn')}
                                    className="bg-blue-600 text-white px-8 py-4 rounded-xl font-semibold text-lg hover:bg-blue-700 transition-all transform hover:scale-105 shadow-lg inline-flex items-center gap-2"
                                >
                                    Start Learning
                                    <ChevronRight className="w-5 h-5" />
                                </button>
                                
                                <p className="mt-6 text-gray-500 text-sm">
                                    Wrong format? <a href="/citations-choice.html" className="text-blue-600 hover:underline">Switch to MLA</a>
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            // COMPLETION SCREEN
            if (screen === 'complete') {
                const percentage = Math.round((score / totalPoints) * 100);
                let badge, emoji, message;
                
                if (percentage >= 90) {
                    badge = "Citation Expert"; emoji = "üèÜ"; message = "Outstanding! You've mastered APA citations.";
                } else if (percentage >= 75) {
                    badge = "Skilled Citer"; emoji = "‚≠ê"; message = "Great work! You have strong citation skills.";
                } else if (percentage >= 60) {
                    badge = "Developing Researcher"; emoji = "üìö"; message = "Good progress! Review the APA format sections.";
                } else {
                    badge = "Citation Apprentice"; emoji = "üå±"; message = "Keep practicing! Consider reviewing this module.";
                }

                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-500 via-indigo-600 to-violet-700 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 lg:p-12 max-w-2xl w-full animate-fadeIn">
                            <div className="text-center">
                                <div className="text-7xl mb-4">{emoji}</div>
                                <p className="text-sm font-semibold text-blue-600 uppercase tracking-wider mb-2">Module Complete!</p>
                                <h1 className="text-4xl font-serif text-gray-900 mb-2">Academic Integrity & Citations</h1>
                                <p className="text-blue-600 font-medium">APA Format</p>
                                
                                <div className="my-8">
                                    <div className="text-6xl font-bold text-blue-600">{score}<span className="text-2xl text-gray-400">/{totalPoints}</span></div>
                                    <p className="text-gray-500 mt-1">{percentage}% Score</p>
                                </div>
                                
                                <div className="bg-blue-50 rounded-xl p-6 mb-6 inline-block">
                                    <p className="text-blue-800 font-semibold text-lg">{badge}</p>
                                    <p className="text-blue-600 text-sm mt-1">{message}</p>
                                </div>

                                <div className="bg-gray-50 rounded-xl p-6 mb-8 text-left">
                                    <h3 className="font-semibold text-gray-900 mb-4">üéì What you learned:</h3>
                                    <ul className="space-y-2 text-gray-700">
                                        <li className="flex items-start gap-2">
                                            <CheckCircle className="w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5" />
                                            <span>Why citations matter and how to avoid plagiarism</span>
                                        </li>
                                        <li className="flex items-start gap-2">
                                            <CheckCircle className="w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5" />
                                            <span>When to quote vs. paraphrase</span>
                                        </li>
                                        <li className="flex items-start gap-2">
                                            <CheckCircle className="w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5" />
                                            <span>APA in-text citations and References format</span>
                                        </li>
                                        <li className="flex items-start gap-2">
                                            <CheckCircle className="w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5" />
                                            <span>How to cite AI tools properly</span>
                                        </li>
                                    </ul>
                                </div>

                                <div className="bg-emerald-50 border border-emerald-200 rounded-xl p-5 mb-8">
                                    <p className="text-emerald-800">
                                        <strong>üéâ Congratulations!</strong> You've completed all three modules of the Research Toolkit. 
                                        You're ready to tackle your IB research project with confidence!
                                    </p>
                                </div>

                                <div className="flex gap-4 justify-center flex-wrap">
                                    <button onClick={restart} className="flex items-center gap-2 px-6 py-3 border border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 transition-colors">
                                        <RefreshCw className="w-5 h-5" />
                                        Try Again
                                    </button>
                                    <a href="./" className="flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors">
                                        Back to Modules
                                        <ChevronRight className="w-5 h-5" />
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // LEARNING SCREEN
            return (
                <div className="min-h-screen bg-gray-50">
                    <header className="bg-white border-b border-gray-200 sticky top-0 z-10">
                        <div className="max-w-4xl mx-auto px-4 py-4">
                            <div className="flex items-center justify-between mb-3">
                                <div className="flex items-center gap-3">
                                    <a href="/citations-choice.html" className="text-gray-400 hover:text-gray-600 transition-colors">
                                        <ChevronLeft className="w-5 h-5" />
                                    </a>
                                    <div>
                                        <p className="text-xs text-gray-500 uppercase tracking-wider">Citations (APA)</p>
                                        <h1 className="font-semibold text-gray-900">{currentStepData?.section}</h1>
                                    </div>
                                </div>
                                <div className="text-right">
                                    <p className="text-sm font-semibold text-blue-600">{score} pts</p>
                                    <p className="text-xs text-gray-500">of {totalPoints}</p>
                                </div>
                            </div>
                            <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div 
                                    className="h-full progress-bar rounded-full bg-blue-500"
                                    style={{ width: `${progressPercent}%` }}
                                ></div>
                            </div>
                            <div className="flex justify-between mt-1">
                                <span className="text-xs text-gray-500">Step {currentStep + 1} of {totalSteps}</span>
                                <span className="text-xs text-gray-500">{Math.round(progressPercent)}% complete</span>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-4xl mx-auto px-4 py-8">
                        <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 lg:p-8 animate-fadeIn" key={currentStep}>
                            <div className="flex items-center gap-2 mb-4">
                                <span className={`text-xs font-semibold px-3 py-1 rounded-full ${
                                    currentStepData?.type === 'quiz' 
                                        ? 'bg-amber-100 text-amber-700' 
                                        : 'bg-blue-100 text-blue-700'
                                }`}>
                                    {currentStepData?.type === 'quiz' ? '‚úçÔ∏è Check Your Understanding' : 'üìñ Learn'}
                                </span>
                            </div>

                            <h2 className="text-2xl lg:text-3xl font-serif text-gray-900 mb-6">{currentStepData?.title}</h2>

                            {currentStepData?.type === 'content' ? (
                                <div>{currentStepData.content}</div>
                            ) : (
                                <div className="space-y-6">
                                    <p className="text-lg text-gray-700 whitespace-pre-line">{currentStepData?.question}</p>
                                    
                                    {showHint && currentStepData?.hint && (
                                        <div className="bg-amber-50 border border-amber-200 rounded-lg p-4 flex items-start gap-3 animate-slideIn">
                                            <Lightbulb className="w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5" />
                                            <p className="text-amber-800 text-sm"><strong>Hint:</strong> {currentStepData.hint}</p>
                                        </div>
                                    )}
                                    
                                    <div className="space-y-3">
                                        {currentStepData?.options?.map((option) => {
                                            let btnClass = "w-full text-left p-4 rounded-xl border-2 transition-all option-btn ";
                                            
                                            const isTriedAnswer = triedAnswers.includes(option.id);
                                            const isCurrentWrongAnswer = showFeedback && option.id === selectedAnswer && !isCorrect;
                                            
                                            if (isTriedAnswer && !showFeedback) {
                                                // Previously tried wrong answer - show as disabled/crossed out
                                                btnClass += "border-gray-200 bg-gray-100 opacity-60 cursor-not-allowed";
                                            } else if (isCurrentWrongAnswer) {
                                                // Currently selected wrong answer during feedback
                                                btnClass += "border-red-500 bg-red-50";
                                            } else if (showFeedback && isCorrect && option.id === selectedAnswer) {
                                                // Correct answer selected
                                                btnClass += "border-emerald-500 bg-emerald-50";
                                            } else if (showFeedback) {
                                                // Other answers during feedback
                                                btnClass += "border-gray-200 opacity-50";
                                            } else if (selectedAnswer === option.id) {
                                                btnClass += "border-blue-500 bg-blue-50";
                                            } else {
                                                btnClass += "border-gray-200 hover:border-gray-300 hover:bg-gray-50";
                                            }
                                            
                                            return (
                                                <button
                                                    key={option.id}
                                                    onClick={() => handleAnswerSelect(option.id)}
                                                    disabled={showFeedback || isTriedAnswer}
                                                    className={btnClass}
                                                >
                                                    <div className="flex items-start gap-3">
                                                        <span className={`w-7 h-7 rounded-full border-2 flex items-center justify-center flex-shrink-0 text-sm font-semibold transition-colors ${
                                                            isTriedAnswer && !showFeedback
                                                                ? 'bg-gray-400 border-gray-400 text-white'
                                                                : isCurrentWrongAnswer
                                                                    ? 'bg-red-500 border-red-500 text-white'
                                                                    : showFeedback && isCorrect && option.id === selectedAnswer
                                                                        ? 'bg-emerald-500 border-emerald-500 text-white'
                                                                        : selectedAnswer === option.id
                                                                            ? 'bg-blue-500 border-blue-500 text-white'
                                                                            : 'border-gray-300 text-gray-500'
                                                        }`}>
                                                            {option.id.toUpperCase()}
                                                        </span>
                                                        <span className={`pt-0.5 ${isTriedAnswer && !showFeedback ? 'text-gray-400 line-through' : 'text-gray-700'}`}>{option.text}</span>
                                                    </div>
                                                </button>
                                            );
                                        })}
                                    </div>

                                    {!showFeedback && selectedAnswer && (
                                        <button
                                            onClick={checkAnswer}
                                            className="bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors"
                                        >
                                            Check Answer
                                        </button>
                                    )}

                                    {/* Feedback for correct answer */}
                                    {showFeedback && isCorrect && (
                                        <div className="p-5 rounded-xl animate-fadeIn bg-emerald-50 border border-emerald-200">
                                            <div className="flex items-start gap-3">
                                                <CheckCircle className="w-6 h-6 text-emerald-500 flex-shrink-0" />
                                                <div>
                                                    <p className="font-semibold text-emerald-800">Correct!</p>
                                                    <p className="mt-1 text-sm text-emerald-700">
                                                        {currentStepData.explanation}
                                                    </p>
                                                    <p className="mt-2 text-emerald-600 font-semibold text-sm">
                                                        +{attempts === 0 ? currentStepData.points : 
                                                          attempts === 1 ? Math.floor(currentStepData.points * 0.75) :
                                                          attempts === 2 ? Math.floor(currentStepData.points * 0.5) :
                                                          Math.floor(currentStepData.points * 0.25)} points
                                                        {attempts === 1 && ' (2nd try)'}
                                                        {attempts === 2 && ' (3rd try)'}
                                                        {attempts >= 3 && ` (${attempts + 1}th try)`}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Feedback for wrong answer - with Try Again button */}
                                    {showFeedback && !isCorrect && (
                                        <div className="p-5 rounded-xl animate-fadeIn bg-red-50 border border-red-200">
                                            <div className="flex items-start gap-3">
                                                <XCircle className="w-6 h-6 text-red-500 flex-shrink-0" />
                                                <div className="flex-1">
                                                    <p className="font-semibold text-red-800">Not quite right</p>
                                                    <p className="mt-1 text-sm text-red-700">
                                                        {currentStepData.wrongFeedback}
                                                    </p>
                                                    <button
                                                        onClick={handleTryAgain}
                                                        className="mt-3 flex items-center gap-2 bg-red-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-red-700 transition-colors"
                                                    >
                                                        <RefreshCw className="w-4 h-4" />
                                                        Try Again
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}

                            <div className="flex items-center justify-between mt-8 pt-6 border-t border-gray-200">
                                <button
                                    onClick={handlePrev}
                                    disabled={currentStep === 0}
                                    className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${
                                        currentStep === 0 ? 'text-gray-300 cursor-not-allowed' : 'text-gray-600 hover:bg-gray-100'
                                    }`}
                                >
                                    <ChevronLeft className="w-5 h-5" />
                                    Previous
                                </button>
                                
                                <button
                                    onClick={handleNext}
                                    disabled={currentStepData?.type === 'quiz' && !(showFeedback && isCorrect)}
                                    className={`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all ${
                                        currentStepData?.type === 'quiz' && !(showFeedback && isCorrect)
                                            ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                            : 'bg-blue-600 text-white hover:bg-blue-700'
                                    }`}
                                >
                                    {currentStep === totalSteps - 1 ? 'Complete Module' : 'Continue'}
                                    <ChevronRight className="w-5 h-5" />
                                </button>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        ReactDOM.render(<CitationsAPAModule />, document.getElementById('root'));
    </script>
</body>
</html>
